---
import SideMenuItem from './SideMenuItem.astro';
import SideMenuCard from './SideMenuCard.astro';
import { actions } from 'astro:actions';

// Fetch de datos en el servidor (Build time o Request time)
const { data: brands } = await Astro.callAction(actions.getUniqueBrands, undefined);
---

<nav class="flex flex-col flex-1 gap-2 min-h-0">
    <div class="flex-1 rounded-xl p-2 flex flex-col gap-4 overflow-y-auto">
        
        <div>
            <ul class="flex flex-col gap-1">
                <SideMenuItem href="/">
                    <span class="text-xl">ðŸ“Š</span>
                    Dashboard Global
                </SideMenuItem>
            </ul>
        </div>

        <div class="h-px bg-zinc-200 mx-2"></div>

        <div class="flex flex-col gap-2 px-1">
            <div class="flex items-center justify-between px-2 mb-1">
                <h2 class="font-bold text-xs text-zinc-400 uppercase tracking-widest">
                    Tus Marcas ({(brands ?? []).length})
                </h2>
                <button class="text-zinc-400 hover:text-zinc-600 transition text-xs">
                    <i class="fa-solid fa-filter"></i>
                </button>
            </div>

            <div class="flex flex-col gap-2 pb-10">
                {(brands ?? []).length > 0 ? (
                    (brands ?? []).map(brand => (
                        <SideMenuCard brand={brand} />
                    ))
                ) : (
                    <div class="p-4 text-center text-xs text-zinc-400 bg-zinc-50 rounded-lg border border-dashed border-zinc-200">
                        No se encontraron marcas activas.
                    </div>
                )}
            </div>
        </div>

    </div>
</nav>
